{"changed":true,"filter":false,"title":"customers.js","tooltip":"/routes/customers.js","value":"var express = require('express');\nvar router = express.Router();\nvar convert = require('./../utilities/converters.js');\n\nrouter.use(function timeLog(req, res, next) {\n\tconsole.log('Accessed Customers URI Page at Time: ', new Date());\n\tnext();\n});\n\n// Get the List of all customers\nrouter.get('/', function(request, response) {\n\tvar query = JSON.parse(JSON.stringify(request.query));\n\tvar limit;\n\tvar offset;\n\tvar sort = {};\n\tvar filter = {};\n\n\tif (!query.offset || isNaN(query.offset)) {\n\t\toffset = request.DEFAULT_OFFSET;\n\t}\n\telse {\n\t\toffset = Number(query.offset);\n\t}\n\n\tif (!query.limit || isNaN(query.limit)) {\n\t\tlimit = request.DEFAULT_LIMIT;\n\t}\n\telse {\n\t\tlimit = Number(query.limit);\n\t}\n\n\tif (query.sort) {\n\t\t// If it contains &&, it need to send a error response\n\t\tvar res = String(query.sort).trim();\n\t\tvar length = res.length;\n\t\tres = res.substr(1, length - 2).split('||');\n\t\tres.forEach(function(element) {\n\t\t\tvar order = 1;\n\t\t\tif (element.indexOf('-') === 0) {\n\t\t\t\torder = -1;\n\t\t\t\telement = element.substr(1, element.length - 1);\n\t\t\t}\n\t\t\telse {\n\t\t\t\torder = 1;\n\t\t\t}\n\n\t\t\tif (element.toUpperCase() === 'LASTNAME') {\n\t\t\t\tsort.last_name = order;\n\t\t\t}\n\t\t\tif (element.toUpperCase() === 'FIRSTNAME') {\n\t\t\t\tsort.first_name = order;\n\t\t\t}\n\t\t\tif (element.toUpperCase() === 'EMAIL') {\n\t\t\t\tsort.email = order;\n\t\t\t}\n\t\t});\n\t}\n\n\tif (!sort) {\n\t\tsort = {\n\t\t\tcustomer_id: 1\n\t\t};\n\t}\n\n\tif (query.filter) {\n\n\t\tconsole.log(query.filter);\n\n\t\tvar res = String(query.filter).trim();\n\t\tvar queryString = getFilterString(res);\n\t}\n\n\tvar collection = request.db.get('customer');\n\n\tcollection.count({}, function(err, count) {\n\n\t\tconsole.log(\"customer count: \" + count);\n\n\t\tif (err) {\n\t\t\tconsole.error(err);\n\t\t\treturn response.status(500).json(err);\n\t\t}\n\n\t\tcollection.find({}, {\n\t\t\tlimit: limit,\n\t\t\tskip: offset,\n\t\t\tsort: sort\n\t\t}, function(err, customers) {\n\t\t\tif (err) {\n\t\t\t\treturn response.status(500).json(err);\n\t\t\t}\n\t\t\telse if (customers) {\n\t\t\t\treturn response.json(convert.fromCustomerDB(customers, true, offset, limit, count, query.sort, query.filter));\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn response.status(404).json(404);\n\t\t\t}\n\t\t});\n\t});\n\n});\n\n// GET, PUT, DELETE, POST of a Particular Customer\nrouter.get('/:id', function(request, response) {\n\tvar collection = request.db.get('customer');\n\tcollection.find({\n\t\tcustomer_id: Number(request.params.id)\n\t}, {}, function(err, customers) {\n\t\tif (err) {\n\t\t\treturn response.status(500).json(err);\n\t\t}\n\t\telse if (customers) {\n\t\t\treturn response.json(convert.fromCustomerDB(customers));\n\t\t}\n\t\telse {\n\t\t\treturn response.status(404).json(404);\n\t\t}\n\t});\n});\n\nrouter.get(\"/:id/address\", function(request, response) {\n\tvar customerCollection = request.db.get('customer');\n\tvar addressCollection = request.db.get('address');\n\tcustomerCollection.find({\n\t\tcustomer_id: Number(request.params.id)\n\t}, {}, function(err, customer) {\n\t\tif (err) {\n\t\t\treturn response.status(500).json(err);\n\t\t}\n\t\telse if (customer[0]) {\n\t\t\taddressCollection.find({\n\t\t\t\taddress_id: Number(customer[0].address_id)\n\t\t\t}, {}, function(err, address) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn response.status(500).json(err);\n\t\t\t\t}\n\t\t\t\telse if (address) {\n\t\t\t\t\treturn response.json(convert.fromAddressDB(address));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn response.status(404).json(404);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\treturn response.status(404).json(404);\n\t\t}\n\t});\n});\n\nrouter.put('/:id', function(req, res) {\n\tvar db = req.db;\n\tvar collection = db.get('customer');\n\tconsole.log(\"Inside put\");\n\n\tif (!req.body) {\n\t\treturn res.send(400);\n\t} // 6\n\n\tvar id = req.params.id;\n\tconsole.log(id);\n\n\tif (!Number(id)) {\n\t\treturn res.send(\"Invalid query parameters\");\n\t}\n\n\t/*\t{ \"_id\" : ObjectId(\"54d7db0f89dc3223d9000552\"), \"customer_id\" : 50, \"store_id\" :\n \t1, \"first_name\" : \"DIANE\", \"last_name\" : \"COLLINS\", \"email\" : \"DIANE.COLLINS@sa\n\tkilacustomer.org\", \"address_id\" : 54, \"active\" : true, \"create_date\" : ISODate(\"\n\t2006-02-15T03:04:36Z\"), \"last_update\" : ISODate(\"2006-02-15T09:57:20Z\") }\n\t> */\n\n\t//Get the other params from the query. Should get a list of query parameters that we will take\n\t//first_name, last_name, email, active, address_id, last_update(auto generated)\n\tcollection.find({\n\t\tcustomer_id: Number(id)\n\t}, {}, function(e, data) {\n\t\tif (e) {\n\t\t\treturn res.send(500, e);\n\t\t} // 1, 2\n\n\t\tconsole.log(\"result of findbyid i.e. data returned \", data);\n\t\tif (!data) {\n\t\t\tconsole.log(\"Inside !data\");\n\t\t\treturn res.send(404);\n\t\t} // 3\n\n\n\t\t//console.log(\"Before update\");\n\t\tvar update = {};\n\t\tif (req.body.first_name != undefined)\n\t\t\tupdate['first_name'] = req.body.first_name;\n\t\tif (req.body.last_name != undefined)\n\t\t\tupdate['last_name'] = req.body.last_name;\n\t\tif (req.body.email != undefined)\n\t\t\tupdate['email'] = req.body.email;\n\t\tif (req.body.active != undefined)\n\t\t\tupdate['active'] = req.body.active;\n\t\tupdate['last_update'] = new Date().toISOString();\n\t\tif (req.body.address_id != undefined) {\n\t\t\t//Continue updating only if the city id mentioned is valid in 'city' collection \n\t\t\tvar addrColl = db.get('address');\n\t\t\taddrColl.count({\n\t\t\t\taddress_id: Number(req.body.address_id)\n\t\t\t}, function(err, count) {\n\t\t\t\tif (err || count === 0) {\n\t\t\t\t\treturn res.send(404, err);\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\"Found the object: \", count);\n\t\t\t\tupdate['address_id'] = req.body.address_id;\n\t\t\t\tUpdateDB(collection, update, res, id);\n\t\t\t\tres.send(\"Update succeeded\");\n\t\t\t});\n\t\t}\n\t\telse //In case city_id not found, update other values\n\t\t{\n\t\t\tUpdateDB(collection, update, res, id);\n\t\t\tres.send(\"Updated succeeded\");\n\t\t}\n\t});\n});\n\nfunction getFilterString(query) {\n\tvar query = query.replace(\"||\", \"$or\");\n\tquery = query.replace(\"&&\", \"$and\");\n\tconsole.log(query);\n\n\tvar arr = query.split(\"$or\");\n\n}\n\nfunction UpdateDB(collection, update, res, id) {\n\tconsole.log(update);\n\n\tcollection.update({\n\t\t\tcustomer_id: Number(id)\n\t\t}, {\n\t\t\t$set: update\n\t\t},\n\t\tfunction(err) {\n\t\t\tif (err) {\n\t\t\t\treturn res.send(500, err);\n\t\t\t}\n\n\t\t\t// Now we can get the order back\n\t\t\t// and see that it's updated\n\t\t\tcollection.find({\n\t\t\t\tcustomer_id: Number(id)\n\t\t\t}, function(err, o) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn res.send(500, err);\n\t\t\t\t}\n\t\t\t\tconsole.log(\"Found the object: \", o);\n\t\t\t});\n\t\t});\n\n\treturn;\n\t//return response.json(convert.toCustomerDB(request.body));\n}\n\n//Delete one customer\nrouter.delete('/:CustId', function(req, res) {\n\tvar db = req.db;\n\tvar collection = db.get('customer');\n\tvar id = parseInt(req.params.CustId);\n\n\tcollection.remove({\n\t\tcustomer_id: id\n\t}, function(err, todo) {\n\t\tif (err) {\n\t\t\tres.end(err);\n\t\t}\n\t\telse\n\t\t\tres.end(\"deleted\");\n\t});\n});\n\n//Create one customer\nrouter.post('/', function(req, res) {\n\t\t\tvar db = req.db;\n\t\t\tvar addCollection = db.get('address');\n\t\t\tvar custCollection = db.get('customer');\n\t\t\tvar countryCollection = db.get('country');\n\t\t\tvar cityCollection = db.get('city');\n\t\t\t//Find address\n\t\t\tcountryCollection.find({\n\t\t\t\t\tcountry: req.body.data.address.city.country\n\t\t\t\t}, {},\n\n\t\t\t\tfunction(e, data) {\n\n\t\t\t\t\tfunction(err, habit) {\n\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\tres.send(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t//Find city\n\t\t\t\t\t\t\tcityCollection.find({\n\t\t\t\t\t\t\t\taddress: Number(req.body.address_id),\n\t\t\t\t\t\t\t\taddress2: '',\n\t\t\t\t\t\t\t\tdistrict\n\n\n\t\t\t\t\t\t\t}, {}, function(e, data) {\n\n\t\t\t\t\t\t\t}, function(err, habit) {\n\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\tres.send(err);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t//Find country\n\t\t\t\t\t\t\t\t\taddCollection.find({\n\t\t\t\t\t\t\t\t\t\taddress: Number(req.body.address_id),\n\t\t\t\t\t\t\t\t\t\taddress2: ''\n\n\t\t\t\t\t\t\t\t\t}, {}, function(e, data) {\n\n\t\t\t\t\t\t\t\t\t}, function(err, habit) {\n\t\t\t\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\t\t\t\tres.send(err);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t//Insert new record\n\t\t\t\t\t\t\t\t\t\t\treq.body.customer_id = 2; //TODO: Add auto-increment logic.\n\t\t\t\t\t\t\t\t\t\t\tnewCutomerData = convert.toCustomerDB(req.body);\n\t\t\t\t\t\t\t\t\t\t\tcustCollection.save(newCustomerData);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t});\n\n\t\tmodule.exports = router;","undoManager":{"mark":93,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":131,"column":11},"end":{"row":131,"column":14},"action":"remove","lines":["log"]},{"start":{"row":131,"column":11},"end":{"row":131,"column":16},"action":"insert","lines":["log()"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":15},"end":{"row":131,"column":17},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":16},"end":{"row":131,"column":17},"action":"insert","lines":["H"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":17},"end":{"row":131,"column":18},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":18},"end":{"row":131,"column":19},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":19},"end":{"row":131,"column":20},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":20},"end":{"row":131,"column":21},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":21},"end":{"row":131,"column":22},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":22},"end":{"row":131,"column":23},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":23},"end":{"row":131,"column":24},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":24},"end":{"row":131,"column":25},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":26},"end":{"row":131,"column":27},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":27},"end":{"row":131,"column":28},"action":"insert","lines":["+"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":28},"end":{"row":131,"column":29},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":29},"end":{"row":131,"column":30},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":30},"end":{"row":131,"column":31},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":31},"end":{"row":131,"column":32},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":29},"end":{"row":131,"column":32},"action":"remove","lines":["cus"]},{"start":{"row":131,"column":29},"end":{"row":131,"column":37},"action":"insert","lines":["customer"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":37},"end":{"row":131,"column":38},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":38},"end":{"row":131,"column":39},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":39},"end":{"row":131,"column":40},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":40},"end":{"row":131,"column":41},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":38},"end":{"row":131,"column":41},"action":"remove","lines":["add"]},{"start":{"row":131,"column":38},"end":{"row":131,"column":48},"action":"insert","lines":["address_id"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":49},"end":{"row":131,"column":50},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":22},"end":{"row":131,"column":0},"action":"insert","lines":["",""]},{"start":{"row":131,"column":0},"end":{"row":131,"column":3},"action":"insert","lines":["\t\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":3},"end":{"row":131,"column":4},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":4},"end":{"row":131,"column":5},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":5},"end":{"row":131,"column":6},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":6},"end":{"row":131,"column":7},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":3},"end":{"row":131,"column":7},"action":"remove","lines":["cons"]},{"start":{"row":131,"column":3},"end":{"row":131,"column":10},"action":"insert","lines":["console"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":10},"end":{"row":131,"column":11},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":11},"end":{"row":131,"column":12},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":11},"end":{"row":131,"column":12},"action":"remove","lines":["l"]},{"start":{"row":131,"column":11},"end":{"row":131,"column":16},"action":"insert","lines":["log()"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":15},"end":{"row":131,"column":16},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":16},"end":{"row":131,"column":17},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":17},"end":{"row":131,"column":18},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":15},"end":{"row":131,"column":18},"action":"remove","lines":["cus"]},{"start":{"row":131,"column":15},"end":{"row":131,"column":23},"action":"insert","lines":["customer"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":24},"end":{"row":131,"column":25},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":132,"column":37},"end":{"row":132,"column":39},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":132,"column":38},"end":{"row":132,"column":39},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":133,"column":54},"end":{"row":133,"column":56},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":133,"column":55},"end":{"row":133,"column":56},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":131,"column":0},"end":{"row":132,"column":53},"action":"remove","lines":["\t\t\tconsole.log(customer);","\t\t\tconsole.log(\"Hahahaha \" + customer[0].address_id);"]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":22},"end":{"row":131,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":19},"end":{"row":130,"column":21},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":20},"end":{"row":130,"column":21},"action":"insert","lines":["0"]}]}],[{"group":"doc","deltas":[{"start":{"row":261,"column":0},"end":{"row":261,"column":3},"action":"remove","lines":["// "]},{"start":{"row":262,"column":0},"end":{"row":262,"column":3},"action":"remove","lines":["// "]},{"start":{"row":263,"column":0},"end":{"row":263,"column":3},"action":"remove","lines":["// "]},{"start":{"row":264,"column":0},"end":{"row":264,"column":3},"action":"remove","lines":["// "]},{"start":{"row":266,"column":0},"end":{"row":266,"column":3},"action":"remove","lines":["// "]},{"start":{"row":267,"column":0},"end":{"row":267,"column":3},"action":"remove","lines":["// "]},{"start":{"row":268,"column":0},"end":{"row":268,"column":3},"action":"remove","lines":["// "]},{"start":{"row":269,"column":0},"end":{"row":269,"column":3},"action":"remove","lines":["// "]},{"start":{"row":270,"column":0},"end":{"row":270,"column":3},"action":"remove","lines":["// "]},{"start":{"row":271,"column":0},"end":{"row":271,"column":3},"action":"remove","lines":["// "]},{"start":{"row":272,"column":0},"end":{"row":272,"column":3},"action":"remove","lines":["// "]},{"start":{"row":273,"column":0},"end":{"row":273,"column":3},"action":"remove","lines":["// "]},{"start":{"row":274,"column":0},"end":{"row":274,"column":3},"action":"remove","lines":["// "]},{"start":{"row":275,"column":0},"end":{"row":275,"column":3},"action":"remove","lines":["// "]},{"start":{"row":277,"column":0},"end":{"row":277,"column":3},"action":"remove","lines":["// "]},{"start":{"row":278,"column":0},"end":{"row":278,"column":3},"action":"remove","lines":["// "]},{"start":{"row":279,"column":0},"end":{"row":279,"column":3},"action":"remove","lines":["// "]},{"start":{"row":280,"column":0},"end":{"row":280,"column":3},"action":"remove","lines":["// "]},{"start":{"row":281,"column":0},"end":{"row":281,"column":3},"action":"remove","lines":["// "]},{"start":{"row":282,"column":0},"end":{"row":282,"column":3},"action":"remove","lines":["// "]},{"start":{"row":283,"column":0},"end":{"row":283,"column":3},"action":"remove","lines":["// "]},{"start":{"row":284,"column":0},"end":{"row":284,"column":3},"action":"remove","lines":["// "]},{"start":{"row":286,"column":0},"end":{"row":286,"column":3},"action":"remove","lines":["// "]},{"start":{"row":288,"column":0},"end":{"row":288,"column":3},"action":"remove","lines":["// "]},{"start":{"row":289,"column":0},"end":{"row":289,"column":3},"action":"remove","lines":["// "]},{"start":{"row":290,"column":0},"end":{"row":290,"column":3},"action":"remove","lines":["// "]},{"start":{"row":291,"column":0},"end":{"row":291,"column":3},"action":"remove","lines":["// "]},{"start":{"row":292,"column":0},"end":{"row":292,"column":3},"action":"remove","lines":["// "]},{"start":{"row":293,"column":0},"end":{"row":293,"column":3},"action":"remove","lines":["// "]},{"start":{"row":294,"column":0},"end":{"row":294,"column":3},"action":"remove","lines":["// "]},{"start":{"row":295,"column":0},"end":{"row":295,"column":3},"action":"remove","lines":["// "]},{"start":{"row":296,"column":0},"end":{"row":296,"column":3},"action":"remove","lines":["// "]},{"start":{"row":297,"column":0},"end":{"row":297,"column":3},"action":"remove","lines":["// "]},{"start":{"row":298,"column":0},"end":{"row":298,"column":3},"action":"remove","lines":["// "]}]}],[{"group":"doc","deltas":[{"start":{"row":147,"column":2},"end":{"row":147,"column":3},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":147,"column":3},"end":{"row":148,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":0},"end":{"row":149,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":148,"column":0},"end":{"row":149,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":147,"column":3},"end":{"row":148,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":118,"column":3},"end":{"row":119,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":282,"column":9},"end":{"row":282,"column":12},"action":"remove","lines":["_id"]}]}],[{"group":"doc","deltas":[{"start":{"row":283,"column":11},"end":{"row":283,"column":34},"action":"remove","lines":["address2: district: cit"]},{"start":{"row":283,"column":11},"end":{"row":283,"column":16},"action":"insert","lines":["'';';"]}]}],[{"group":"doc","deltas":[{"start":{"row":283,"column":12},"end":{"row":283,"column":15},"action":"remove","lines":["';'"]},{"start":{"row":283,"column":12},"end":{"row":283,"column":13},"action":"insert","lines":["'"]}]}],[{"group":"doc","deltas":[{"start":{"row":283,"column":9},"end":{"row":283,"column":10},"action":"insert","lines":["2"]}]}],[{"group":"doc","deltas":[{"start":{"row":282,"column":10},"end":{"row":282,"column":11},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":283,"column":14},"end":{"row":283,"column":15},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":280,"column":41},"end":{"row":282,"column":41},"action":"insert","lines":["","\tvar addCollection = db.get('co');","\tvar custCollection = db.get('customer');"]}]}],[{"group":"doc","deltas":[{"start":{"row":281,"column":31},"end":{"row":281,"column":36},"action":"insert","lines":["untry"]}]}],[{"group":"doc","deltas":[{"start":{"row":282,"column":30},"end":{"row":282,"column":38},"action":"remove","lines":["customer"]},{"start":{"row":282,"column":30},"end":{"row":282,"column":34},"action":"insert","lines":["city"]}]}],[{"group":"doc","deltas":[{"start":{"row":282,"column":37},"end":{"row":283,"column":1},"action":"insert","lines":["","\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":282,"column":6},"end":{"row":282,"column":9},"action":"remove","lines":["ust"]},{"start":{"row":282,"column":6},"end":{"row":282,"column":9},"action":"insert","lines":["ity"]}]}],[{"group":"doc","deltas":[{"start":{"row":281,"column":5},"end":{"row":281,"column":8},"action":"remove","lines":["add"]},{"start":{"row":281,"column":5},"end":{"row":281,"column":11},"action":"insert","lines":["countr"]}]}],[{"group":"doc","deltas":[{"start":{"row":281,"column":11},"end":{"row":281,"column":12},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":295,"column":3},"end":{"row":297,"column":40},"action":"remove","lines":["req.body.customer_id = 2; //TODO: Add auto-increment logic.","\t\t\tnewCutomerData = convert.toCustomerDB(req.body);","\t\t\tcustCollection.save(newCustomerData);"]},{"start":{"row":295,"column":3},"end":{"row":310,"column":4},"action":"insert","lines":["addCollection.find({","\t\taddress:Number(req.body.address_id),","\t\taddress2: ''","","\t}, {}, function(e, data) {","","\t}, function(err, habit) {","\t\tif (err) {","\t\t\tres.send(err);","\t\t}","\t\telse {","\t\t\treq.body.customer_id = 2; //TODO: Add auto-increment logic.","\t\t\tnewCutomerData = convert.toCustomerDB(req.body);","\t\t\tcustCollection.save(newCustomerData);","\t\t}","\t});"]}]}],[{"group":"doc","deltas":[{"start":{"row":296,"column":0},"end":{"row":296,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":297,"column":0},"end":{"row":297,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":298,"column":0},"end":{"row":298,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":299,"column":0},"end":{"row":299,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":300,"column":0},"end":{"row":300,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":301,"column":0},"end":{"row":301,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":302,"column":0},"end":{"row":302,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":303,"column":0},"end":{"row":303,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":304,"column":0},"end":{"row":304,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":305,"column":0},"end":{"row":305,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":306,"column":0},"end":{"row":306,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":307,"column":0},"end":{"row":307,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":308,"column":0},"end":{"row":308,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":309,"column":0},"end":{"row":309,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":310,"column":0},"end":{"row":310,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":296,"column":0},"end":{"row":296,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":297,"column":0},"end":{"row":297,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":298,"column":0},"end":{"row":298,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":299,"column":0},"end":{"row":299,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":300,"column":0},"end":{"row":300,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":301,"column":0},"end":{"row":301,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":302,"column":0},"end":{"row":302,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":303,"column":0},"end":{"row":303,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":304,"column":0},"end":{"row":304,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":305,"column":0},"end":{"row":305,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":306,"column":0},"end":{"row":306,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":307,"column":0},"end":{"row":307,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":308,"column":0},"end":{"row":308,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":309,"column":0},"end":{"row":309,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":310,"column":0},"end":{"row":310,"column":1},"action":"insert","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":283,"column":1},"end":{"row":283,"column":15},"action":"insert","lines":["//Find address"]}]}],[{"group":"doc","deltas":[{"start":{"row":294,"column":8},"end":{"row":295,"column":10},"action":"insert","lines":["","\t\t\t//Find "]}]}],[{"group":"doc","deltas":[{"start":{"row":295,"column":10},"end":{"row":295,"column":14},"action":"insert","lines":["city"]}]}],[{"group":"doc","deltas":[{"start":{"row":296,"column":4},"end":{"row":296,"column":6},"action":"remove","lines":["dd"]}]}],[{"group":"doc","deltas":[{"start":{"row":296,"column":3},"end":{"row":296,"column":4},"action":"remove","lines":["a"]},{"start":{"row":296,"column":3},"end":{"row":296,"column":7},"action":"insert","lines":["city"]}]}],[{"group":"doc","deltas":[{"start":{"row":307,"column":5},"end":{"row":309,"column":42},"action":"remove","lines":["req.body.customer_id = 2; //TODO: Add auto-increment logic.","\t\t\t\t\tnewCutomerData = convert.toCustomerDB(req.body);","\t\t\t\t\tcustCollection.save(newCustomerData);"]},{"start":{"row":307,"column":5},"end":{"row":322,"column":4},"action":"insert","lines":["addCollection.find({","\t\taddress:Number(req.body.address_id),","\t\taddress2: ''","","\t}, {}, function(e, data) {","","\t}, function(err, habit) {","\t\tif (err) {","\t\t\tres.send(err);","\t\t}","\t\telse {","\t\t\treq.body.customer_id = 2; //TODO: Add auto-increment logic.","\t\t\tnewCutomerData = convert.toCustomerDB(req.body);","\t\t\tcustCollection.save(newCustomerData);","\t\t}","\t});"]}]}],[{"group":"doc","deltas":[{"start":{"row":308,"column":0},"end":{"row":308,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":309,"column":0},"end":{"row":309,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":310,"column":0},"end":{"row":310,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":311,"column":0},"end":{"row":311,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":312,"column":0},"end":{"row":312,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":313,"column":0},"end":{"row":313,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":314,"column":0},"end":{"row":314,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":315,"column":0},"end":{"row":315,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":316,"column":0},"end":{"row":316,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":317,"column":0},"end":{"row":317,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":318,"column":0},"end":{"row":318,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":319,"column":0},"end":{"row":319,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":320,"column":0},"end":{"row":320,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":321,"column":0},"end":{"row":321,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":322,"column":0},"end":{"row":322,"column":4},"action":"insert","lines":["\t\t\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":306,"column":10},"end":{"row":307,"column":5},"action":"insert","lines":["","\t\t\t\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":307,"column":5},"end":{"row":307,"column":19},"action":"insert","lines":["//Find country"]}]}],[{"group":"doc","deltas":[{"start":{"row":318,"column":12},"end":{"row":319,"column":20},"action":"insert","lines":["","\t\t\t\t\t\t\t//Insert new "]}]}],[{"group":"doc","deltas":[{"start":{"row":319,"column":20},"end":{"row":319,"column":26},"action":"insert","lines":["record"]}]}],[{"group":"doc","deltas":[{"start":{"row":298,"column":16},"end":{"row":299,"column":12},"action":"insert","lines":[",","\t\t\t\tdistrict"]}]}],[{"group":"doc","deltas":[{"start":{"row":299,"column":12},"end":{"row":300,"column":4},"action":"insert","lines":["","\t\t\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":284,"column":1},"end":{"row":284,"column":4},"action":"remove","lines":["add"]},{"start":{"row":284,"column":1},"end":{"row":284,"column":5},"action":"insert","lines":["city"]}]}],[{"group":"doc","deltas":[{"start":{"row":284,"column":1},"end":{"row":284,"column":5},"action":"remove","lines":["city"]},{"start":{"row":284,"column":1},"end":{"row":284,"column":8},"action":"insert","lines":["country"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":2},"end":{"row":285,"column":9},"action":"remove","lines":["address"]},{"start":{"row":285,"column":2},"end":{"row":285,"column":9},"action":"insert","lines":["country"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":10},"end":{"row":285,"column":17},"action":"remove","lines":["Number("]},{"start":{"row":285,"column":29},"end":{"row":285,"column":30},"action":"remove","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":19},"end":{"row":285,"column":27},"action":"insert","lines":["data.add"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":27},"end":{"row":285,"column":34},"action":"insert","lines":["ress.ci"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":34},"end":{"row":285,"column":42},"action":"insert","lines":["ty.count"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":37},"end":{"row":285,"column":42},"action":"remove","lines":["count"]},{"start":{"row":285,"column":37},"end":{"row":285,"column":44},"action":"insert","lines":["country"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":44},"end":{"row":285,"column":54},"action":"remove","lines":["address_id"]}]}],[{"group":"doc","deltas":[{"start":{"row":285,"column":45},"end":{"row":286,"column":14},"action":"remove","lines":["","\t\taddress2: ''"]}]}],[{"group":"doc","deltas":[{"start":{"row":130,"column":27},"end":{"row":131,"column":4},"action":"insert","lines":["","\t\t\t\t"]},{"start":{"row":131,"column":46},"end":{"row":132,"column":3},"action":"insert","lines":["","\t\t\t"]},{"start":{"row":287,"column":10},"end":{"row":287,"column":11},"action":"insert","lines":[" "]},{"start":{"row":298,"column":12},"end":{"row":298,"column":13},"action":"insert","lines":[" "]},{"start":{"row":301,"column":0},"end":{"row":302,"column":2},"action":"remove","lines":["\t\t\t\t","\t\t"]},{"start":{"row":301,"column":0},"end":{"row":302,"column":0},"action":"insert","lines":["",""]},{"start":{"row":304,"column":0},"end":{"row":304,"column":2},"action":"remove","lines":["\t\t"]},{"start":{"row":312,"column":14},"end":{"row":312,"column":15},"action":"insert","lines":[" "]},{"start":{"row":314,"column":0},"end":{"row":314,"column":4},"action":"remove","lines":["\t\t\t\t"]},{"start":{"row":316,"column":0},"end":{"row":316,"column":4},"action":"remove","lines":["\t\t\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":287,"column":45},"end":{"row":287,"column":46},"action":"remove","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":287,"column":45},"end":{"row":288,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":288,"column":27},"end":{"row":290,"column":1},"action":"remove","lines":["","","\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":288,"column":27},"end":{"row":288,"column":29},"action":"remove","lines":["},"]}]}],[{"group":"doc","deltas":[{"start":{"row":288,"column":8},"end":{"row":290,"column":1},"action":"insert","lines":["","\t","\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":290,"column":21},"end":{"row":292,"column":2},"action":"insert","lines":["","\t\t","\t\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":262,"column":44},"end":{"row":262,"column":45},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":262,"column":44},"end":{"row":262,"column":45},"action":"insert","lines":[" "]},{"start":{"row":280,"column":1},"end":{"row":280,"column":3},"action":"insert","lines":["\t\t"]},{"start":{"row":281,"column":0},"end":{"row":281,"column":2},"action":"insert","lines":["\t\t"]},{"start":{"row":282,"column":0},"end":{"row":282,"column":2},"action":"insert","lines":["\t\t"]},{"start":{"row":283,"column":1},"end":{"row":283,"column":3},"action":"insert","lines":["\t\t"]},{"start":{"row":284,"column":1},"end":{"row":284,"column":3},"action":"insert","lines":["\t\t"]},{"start":{"row":285,"column":0},"end":{"row":285,"column":2},"action":"insert","lines":["\t\t"]},{"start":{"row":286,"column":1},"end":{"row":286,"column":3},"action":"insert","lines":["\t\t"]},{"start":{"row":287,"column":0},"end":{"row":287,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":288,"column":1},"end":{"row":288,"column":4},"action":"insert","lines":["\t\t\t"]},{"start":{"row":288,"column":10},"end":{"row":288,"column":11},"action":"remove","lines":[" "]},{"start":{"row":288,"column":10},"end":{"row":289,"column":0},"action":"insert","lines":["",""]},{"start":{"row":290,"column":1},"end":{"row":291,"column":0},"action":"remove","lines":["",""]},{"start":{"row":290,"column":1},"end":{"row":290,"column":3},"action":"insert","lines":["\t\t"]},{"start":{"row":290,"column":23},"end":{"row":290,"column":24},"action":"remove","lines":[" "]},{"start":{"row":290,"column":23},"end":{"row":291,"column":0},"action":"insert","lines":["",""]},{"start":{"row":292,"column":2},"end":{"row":293,"column":0},"action":"remove","lines":["",""]},{"start":{"row":292,"column":2},"end":{"row":292,"column":3},"action":"insert","lines":["\t"]},{"start":{"row":293,"column":0},"end":{"row":293,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":294,"column":3},"end":{"row":294,"column":7},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":295,"column":2},"end":{"row":295,"column":6},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":296,"column":0},"end":{"row":296,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":297,"column":3},"end":{"row":297,"column":7},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":298,"column":0},"end":{"row":298,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":299,"column":0},"end":{"row":299,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":299,"column":5},"end":{"row":299,"column":8},"action":"insert","lines":["\t\t\t"]},{"start":{"row":300,"column":0},"end":{"row":300,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":300,"column":7},"end":{"row":300,"column":8},"action":"insert","lines":["\t"]},{"start":{"row":301,"column":4},"end":{"row":301,"column":8},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":304,"column":0},"end":{"row":304,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":306,"column":3},"end":{"row":306,"column":7},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":307,"column":4},"end":{"row":307,"column":8},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":308,"column":0},"end":{"row":308,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":308,"column":6},"end":{"row":308,"column":9},"action":"insert","lines":["\t\t\t"]},{"start":{"row":309,"column":0},"end":{"row":309,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":309,"column":7},"end":{"row":309,"column":8},"action":"insert","lines":["\t"]},{"start":{"row":310,"column":0},"end":{"row":310,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":311,"column":0},"end":{"row":311,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":311,"column":6},"end":{"row":311,"column":9},"action":"insert","lines":["\t\t\t"]},{"start":{"row":312,"column":0},"end":{"row":312,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":312,"column":8},"end":{"row":312,"column":9},"action":"insert","lines":["\t"]},{"start":{"row":313,"column":0},"end":{"row":313,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":314,"column":6},"end":{"row":314,"column":10},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":316,"column":0},"end":{"row":316,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":316,"column":8},"end":{"row":316,"column":9},"action":"insert","lines":["\t"]},{"start":{"row":318,"column":5},"end":{"row":318,"column":9},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":319,"column":0},"end":{"row":319,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":319,"column":7},"end":{"row":319,"column":10},"action":"insert","lines":["\t\t\t"]},{"start":{"row":320,"column":0},"end":{"row":320,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":320,"column":10},"end":{"row":320,"column":11},"action":"insert","lines":["\t"]},{"start":{"row":321,"column":6},"end":{"row":321,"column":10},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":322,"column":0},"end":{"row":322,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":322,"column":7},"end":{"row":322,"column":10},"action":"insert","lines":["\t\t\t"]},{"start":{"row":323,"column":0},"end":{"row":323,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":323,"column":10},"end":{"row":323,"column":11},"action":"insert","lines":["\t"]},{"start":{"row":324,"column":0},"end":{"row":324,"column":4},"action":"insert","lines":["\t\t\t\t"]},{"start":{"row":325,"column":0},"end":{"row":325,"column":1},"action":"insert","lines":["\t"]},{"start":{"row":325,"column":8},"end":{"row":325,"column":11},"action":"insert","lines":["\t\t\t"]},{"start":{"row":326,"column":0},"end":{"row":326,"column":3},"action":"insert","lines":["\t\t\t"]},{"start":{"row":326,"column":10},"end":{"row":326,"column":11},"action":"insert","lines":["\t"]},{"start":{"row":326,"column":46},"end":{"row":330,"column":8},"action":"insert","lines":[");","\t\t\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t\t}"]},{"start":{"row":333,"column":0},"end":{"row":334,"column":0},"action":"remove","lines":["\t\t\t\t}",""]},{"start":{"row":334,"column":0},"end":{"row":335,"column":0},"action":"insert","lines":["",""]},{"start":{"row":335,"column":2},"end":{"row":339,"column":0},"action":"remove","lines":["}","\t});","});","",""]}]}]]},"ace":{"folds":[],"customSyntax":"javascript","scrolltop":0,"scrollleft":0,"selection":{"start":{"row":14,"column":15},"end":{"row":14,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1423795651980}